{
  "oauth_config": {
    "platform": "databricks",
    "description": "Databricks OAuth 2.0 Configuration for DoD RBAC Integration",
    "version": "2.0.0",
    "classification": "UNCLASSIFIED//CUI",
    
    "client_configuration": {
      "client_id": "${DATABRICKS_OAUTH_CLIENT_ID}",
      "client_secret": "${DATABRICKS_OAUTH_CLIENT_SECRET}",
      "client_type": "confidential",
      "authentication_method": "client_secret_post",
      
      "redirect_uris": [
        "${DATABRICKS_OAUTH_REDIRECT_URI}",
        "${DATABRICKS_OAUTH_REDIRECT_URI_BACKUP}"
      ],
      
      "post_logout_redirect_uris": [
        "${DATABRICKS_OAUTH_LOGOUT_URI}",
        "${DATABRICKS_OAUTH_LOGOUT_URI_BACKUP}"
      ]
    },
    
    "endpoints": {
      "nipr": {
        "authorization_url": "https://databricks.advana.data.mil/oauth2/authorize",
        "token_url": "https://databricks.advana.data.mil/oauth2/token",
        "userinfo_url": "https://databricks.advana.data.mil/oauth2/userinfo",
        "jwks_uri": "https://databricks.advana.data.mil/.well-known/jwks.json",
        "revoke_url": "https://databricks.advana.data.mil/oauth2/revoke",
        "introspect_url": "https://databricks.advana.data.mil/oauth2/introspect",
        "issuer": "https://databricks.advana.data.mil",
        "workspace_url": "https://databricks.advana.data.mil"
      },
      
      "sipr": {
        "authorization_url": "https://databricks.sipr.mil/oauth2/authorize",
        "token_url": "https://databricks.sipr.mil/oauth2/token",
        "userinfo_url": "https://databricks.sipr.mil/oauth2/userinfo",
        "jwks_uri": "https://databricks.sipr.mil/.well-known/jwks.json",
        "revoke_url": "https://databricks.sipr.mil/oauth2/revoke",
        "introspect_url": "https://databricks.sipr.mil/oauth2/introspect",
        "issuer": "https://databricks.sipr.mil",
        "workspace_url": "https://databricks.sipr.mil"
      },
      
      "development": {
        "authorization_url": "https://databricks-dev.local/oauth2/authorize",
        "token_url": "https://databricks-dev.local/oauth2/token",
        "userinfo_url": "https://databricks-dev.local/oauth2/userinfo",
        "jwks_uri": "https://databricks-dev.local/.well-known/jwks.json",
        "revoke_url": "https://databricks-dev.local/oauth2/revoke",
        "introspect_url": "https://databricks-dev.local/oauth2/introspect",
        "issuer": "https://databricks-dev.local",
        "workspace_url": "https://databricks-dev.local"
      }
    },
    
    "scopes": {
      "required": ["openid", "profile", "email"],
      "optional": [
        "databricks:workspace",
        "databricks:clusters",
        "databricks:jobs",
        "databricks:notebooks",
        "databricks:sql",
        "databricks:admin"
      ],
      "rbac_mapping": {
        "databricks:workspace": ["analyst", "operator"],
        "databricks:clusters": ["data_steward", "analyst"],
        "databricks:jobs": ["analyst", "data_steward"],
        "databricks:notebooks": ["analyst", "data_steward"],
        "databricks:sql": ["analyst", "data_steward"],
        "databricks:admin": ["system_admin", "security_admin"]
      }
    },
    
    "token_configuration": {
      "access_token": {
        "lifetime": 3600,
        "type": "JWT",
        "algorithm": "RS256",
        "audience": "databricks-rbac-system",
        "issuer_validation": true
      },
      
      "refresh_token": {
        "lifetime": 86400,
        "rotation_enabled": true,
        "reuse_detection": true,
        "revocation_enabled": true
      },
      
      "id_token": {
        "lifetime": 3600,
        "algorithm": "RS256",
        "claims_required": ["sub", "aud", "iss", "exp", "iat", "nonce"],
        "custom_claims": ["clearance_level", "compartments", "organization", "workspace_id"]
      }
    },
    
    "security_settings": {
      "pkce": {
        "enabled": true,
        "code_challenge_method": "S256",
        "required_for_public_clients": true
      },
      
      "state_parameter": {
        "enabled": true,
        "entropy_bits": 128,
        "validation_required": true
      },
      
      "nonce": {
        "enabled": true,
        "entropy_bits": 128,
        "validation_required": true
      },
      
      "tls": {
        "minimum_version": "1.3",
        "certificate_validation": true,
        "hostname_verification": true,
        "cipher_suites": ["TLS_AES_256_GCM_SHA384", "TLS_CHACHA20_POLY1305_SHA256"]
      }
    },
    
    "cac_piv_integration": {
      "enabled": true,
      "certificate_binding": true,
      "pin_verification": true,
      "card_authentication": true,
      
      "certificate_validation": {
        "ocsp_validation": true,
        "crl_validation": true,
        "path_validation": true,
        "trust_anchor_validation": true
      },
      
      "subject_mapping": {
        "dn_attribute": "subject",
        "email_attribute": "subjectAltName",
        "edipi_attribute": "subjectAltName"
      }
    },
    
    "rbac_integration": {
      "role_claim": "databricks_roles",
      "permission_claim": "databricks_permissions",
      "clearance_claim": "security_clearance",
      "compartment_claim": "compartments",
      "workspace_claim": "workspace_id",
      
      "attribute_mapping": {
        "user_id": "sub",
        "email": "email",
        "name": "name",
        "organization": "org",
        "department": "dept",
        "clearance_level": "clearance",
        "edipi": "edipi",
        "workspace_id": "workspace_id"
      },
      
      "role_hierarchy": {
        "databricks:admin": {
          "inherits": ["databricks:developer", "databricks:analyst", "databricks:user"],
          "rbac_roles": ["system_admin", "security_admin"]
        },
        "databricks:developer": {
          "inherits": ["databricks:analyst", "databricks:user"],
          "rbac_roles": ["data_steward", "analyst"]
        },
        "databricks:analyst": {
          "inherits": ["databricks:user"],
          "rbac_roles": ["analyst"]
        },
        "databricks:user": {
          "rbac_roles": ["operator"]
        }
      }
    },
    
    "permission_mapping": {
      "databricks_permissions": {
        "workspace.read": {
          "rbac_permissions": ["databricks:workspace:read"],
          "classification_required": "UNCLASSIFIED"
        },
        "workspace.manage": {
          "rbac_permissions": ["databricks:workspace:manage"],
          "classification_required": "CONFIDENTIAL",
          "approval_required": true
        },
        "cluster.read": {
          "rbac_permissions": ["databricks:cluster:read"],
          "classification_required": "UNCLASSIFIED"
        },
        "cluster.create": {
          "rbac_permissions": ["databricks:cluster:create"],
          "classification_required": "CONFIDENTIAL",
          "approval_required": true,
          "resource_limits": {
            "max_workers": 10,
            "max_runtime_hours": 8
          }
        },
        "cluster.start": {
          "rbac_permissions": ["databricks:cluster:start"],
          "classification_required": "UNCLASSIFIED",
          "audit_required": true
        },
        "cluster.terminate": {
          "rbac_permissions": ["databricks:cluster:terminate"],
          "classification_required": "UNCLASSIFIED",
          "audit_required": true
        },
        "cluster.delete": {
          "rbac_permissions": ["databricks:cluster:delete"],
          "classification_required": "CONFIDENTIAL",
          "approval_required": true,
          "dual_authorization": true
        },
        "notebook.read": {
          "rbac_permissions": ["databricks:notebook:read"],
          "classification_required": "UNCLASSIFIED",
          "need_to_know": true
        },
        "notebook.create": {
          "rbac_permissions": ["databricks:notebook:create"],
          "classification_required": "UNCLASSIFIED"
        },
        "notebook.edit": {
          "rbac_permissions": ["databricks:notebook:edit"],
          "classification_required": "UNCLASSIFIED",
          "audit_required": true
        },
        "notebook.delete": {
          "rbac_permissions": ["databricks:notebook:delete"],
          "classification_required": "CONFIDENTIAL",
          "approval_required": true
        },
        "job.read": {
          "rbac_permissions": ["databricks:job:read"],
          "classification_required": "UNCLASSIFIED"
        },
        "job.create": {
          "rbac_permissions": ["databricks:job:create"],
          "classification_required": "CONFIDENTIAL",
          "approval_required": true
        },
        "job.run": {
          "rbac_permissions": ["databricks:job:run"],
          "classification_required": "UNCLASSIFIED",
          "audit_required": true
        },
        "job.cancel": {
          "rbac_permissions": ["databricks:job:cancel"],
          "classification_required": "UNCLASSIFIED"
        },
        "job.delete": {
          "rbac_permissions": ["databricks:job:delete"],
          "classification_required": "CONFIDENTIAL",
          "approval_required": true
        },
        "sql.read": {
          "rbac_permissions": ["databricks:sql:read"],
          "classification_required": "UNCLASSIFIED",
          "need_to_know": true
        },
        "sql.execute": {
          "rbac_permissions": ["databricks:sql:execute"],
          "classification_required": "UNCLASSIFIED",
          "audit_required": true,
          "query_validation": true
        },
        "data.read": {
          "rbac_permissions": ["databricks:data:read"],
          "classification_required": "UNCLASSIFIED",
          "need_to_know": true,
          "data_classification_check": true
        },
        "data.write": {
          "rbac_permissions": ["databricks:data:write"],
          "classification_required": "CONFIDENTIAL",
          "approval_required": true,
          "audit_required": true,
          "data_loss_prevention": true
        },
        "data.export": {
          "rbac_permissions": ["databricks:data:export"],
          "classification_required": "SECRET",
          "approval_required": true,
          "dual_authorization": true,
          "audit_required": true,
          "export_restrictions": {
            "max_rows": 10000,
            "allowed_formats": ["csv", "json"],
            "approval_workflow": true
          }
        }
      }
    },
    
    "workspace_configuration": {
      "workspace_mapping": {
        "nipr_workspace": {
          "workspace_id": "${NIPR_WORKSPACE_ID}",
          "classification": "UNCLASSIFIED",
          "url": "https://databricks.advana.data.mil"
        },
        "sipr_workspace": {
          "workspace_id": "${SIPR_WORKSPACE_ID}",
          "classification": "SECRET",
          "url": "https://databricks.sipr.mil"
        }
      },
      
      "resource_limits": {
        "max_clusters_per_user": 3,
        "max_concurrent_jobs": 5,
        "max_notebook_size_mb": 50,
        "max_cluster_runtime_hours": 8,
        "auto_termination_minutes": 120
      },
      
      "security_policies": {
        "ip_whitelist_enabled": true,
        "vpc_endpoint_required": true,
        "encryption_at_rest": true,
        "encryption_in_transit": true,
        "audit_logging": true,
        "data_lineage_tracking": true
      }
    },
    
    "session_management": {
      "session_timeout": 3600,
      "idle_timeout": 900,
      "max_concurrent_sessions": 3,
      "session_tracking": true,
      "device_binding": true,
      "workspace_session_isolation": true,
      
      "logout": {
        "front_channel_logout": true,
        "back_channel_logout": true,
        "session_cleanup": true,
        "token_revocation": true,
        "cluster_termination": true
      }
    },
    
    "audit_configuration": {
      "enabled": true,
      "log_authentication": true,
      "log_authorization": true,
      "log_token_operations": true,
      "log_permission_checks": true,
      "log_resource_access": true,
      "log_data_operations": true,
      
      "audit_events": [
        "oauth_authentication_start",
        "oauth_authentication_success",
        "oauth_authentication_failure",
        "token_issued",
        "token_refreshed",
        "token_revoked",
        "permission_granted",
        "permission_denied",
        "workspace_access",
        "cluster_created",
        "cluster_started",
        "cluster_terminated",
        "job_created",
        "job_executed",
        "notebook_accessed",
        "data_accessed",
        "data_exported",
        "session_created",
        "session_expired",
        "logout_initiated"
      ],
      
      "retention_policy": {
        "authentication_logs": "3 years",
        "authorization_logs": "7 years",
        "token_logs": "1 year",
        "session_logs": "1 year",
        "resource_access_logs": "7 years",
        "data_access_logs": "7 years"
      }
    },
    
    "error_handling": {
      "retry_configuration": {
        "max_retries": 3,
        "backoff_strategy": "exponential",
        "initial_delay": 1000,
        "max_delay": 30000
      },
      
      "error_responses": {
        "authentication_failure": {
          "error_code": "authentication_failed",
          "message": "Authentication failed",
          "log_level": "WARNING"
        },
        "authorization_failure": {
          "error_code": "access_denied",
          "message": "Access denied",
          "log_level": "WARNING"
        },
        "token_expired": {
          "error_code": "token_expired",
          "message": "Token has expired",
          "log_level": "INFO"
        },
        "invalid_scope": {
          "error_code": "invalid_scope",
          "message": "Invalid or insufficient scope",
          "log_level": "WARNING"
        },
        "workspace_access_denied": {
          "error_code": "workspace_access_denied",
          "message": "Access to workspace denied",
          "log_level": "WARNING"
        },
        "resource_limit_exceeded": {
          "error_code": "resource_limit_exceeded",
          "message": "Resource limit exceeded",
          "log_level": "WARNING"
        }
      }
    },
    
    "monitoring": {
      "health_checks": {
        "enabled": true,
        "endpoint": "/health/databricks-oauth",
        "interval": 60,
        "timeout": 10,
        "workspace_connectivity": true
      },
      
      "metrics": {
        "enabled": true,
        "authentication_success_rate": true,
        "token_issuance_rate": true,
        "permission_check_latency": true,
        "error_rate": true,
        "workspace_access_rate": true,
        "resource_usage": true
      },
      
      "alerts": {
        "authentication_failure_threshold": 10,
        "token_error_threshold": 5,
        "permission_denial_threshold": 20,
        "response_time_threshold": 5000,
        "workspace_connectivity_failure": 1,
        "resource_limit_threshold": 0.8
      }
    },
    
    "development_settings": {
      "debug_mode": false,
      "verbose_logging": false,
      "token_introspection_logging": false,
      "skip_certificate_validation": false,
      "mock_cac_validation": false,
      "local_workspace_url": "https://databricks-dev.local"
    }
  }
}