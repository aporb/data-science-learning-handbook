{
  "oauth_config": {
    "platform": "qlik",
    "description": "Qlik Sense OAuth 2.0 Configuration for DoD RBAC Integration",
    "version": "2.0.0",
    "classification": "UNCLASSIFIED//CUI",
    
    "client_configuration": {
      "client_id": "${QLIK_OAUTH_CLIENT_ID}",
      "client_secret": "${QLIK_OAUTH_CLIENT_SECRET}",
      "client_type": "confidential",
      "authentication_method": "client_secret_post",
      
      "redirect_uris": [
        "${QLIK_OAUTH_REDIRECT_URI}",
        "${QLIK_OAUTH_REDIRECT_URI_BACKUP}"
      ],
      
      "post_logout_redirect_uris": [
        "${QLIK_OAUTH_LOGOUT_URI}",
        "${QLIK_OAUTH_LOGOUT_URI_BACKUP}"
      ]
    },
    
    "endpoints": {
      "nipr": {
        "authorization_url": "https://qlik.advana.data.mil/oauth2/authorize",
        "token_url": "https://qlik.advana.data.mil/oauth2/token",
        "userinfo_url": "https://qlik.advana.data.mil/oauth2/userinfo",
        "jwks_uri": "https://qlik.advana.data.mil/.well-known/jwks.json",
        "revoke_url": "https://qlik.advana.data.mil/oauth2/revoke",
        "introspect_url": "https://qlik.advana.data.mil/oauth2/introspect",
        "issuer": "https://qlik.advana.data.mil"
      },
      
      "sipr": {
        "authorization_url": "https://qlik.sipr.mil/oauth2/authorize",
        "token_url": "https://qlik.sipr.mil/oauth2/token",
        "userinfo_url": "https://qlik.sipr.mil/oauth2/userinfo",
        "jwks_uri": "https://qlik.sipr.mil/.well-known/jwks.json",
        "revoke_url": "https://qlik.sipr.mil/oauth2/revoke",
        "introspect_url": "https://qlik.sipr.mil/oauth2/introspect",
        "issuer": "https://qlik.sipr.mil"
      },
      
      "development": {
        "authorization_url": "https://qlik-dev.local/oauth2/authorize",
        "token_url": "https://qlik-dev.local/oauth2/token",
        "userinfo_url": "https://qlik-dev.local/oauth2/userinfo",
        "jwks_uri": "https://qlik-dev.local/.well-known/jwks.json",
        "revoke_url": "https://qlik-dev.local/oauth2/revoke",
        "introspect_url": "https://qlik-dev.local/oauth2/introspect",
        "issuer": "https://qlik-dev.local"
      }
    },
    
    "scopes": {
      "required": ["openid", "profile", "email"],
      "optional": ["qlik:user", "qlik:admin", "qlik:developer"],
      "rbac_mapping": {
        "qlik:user": ["analyst", "operator"],
        "qlik:admin": ["data_steward", "security_admin"],
        "qlik:developer": ["analyst", "data_steward"]
      }
    },
    
    "token_configuration": {
      "access_token": {
        "lifetime": 3600,
        "type": "JWT",
        "algorithm": "RS256",
        "audience": "qlik-rbac-system",
        "issuer_validation": true
      },
      
      "refresh_token": {
        "lifetime": 86400,
        "rotation_enabled": true,
        "reuse_detection": true,
        "revocation_enabled": true
      },
      
      "id_token": {
        "lifetime": 3600,
        "algorithm": "RS256",
        "claims_required": ["sub", "aud", "iss", "exp", "iat", "nonce"],
        "custom_claims": ["clearance_level", "compartments", "organization"]
      }
    },
    
    "security_settings": {
      "pkce": {
        "enabled": true,
        "code_challenge_method": "S256",
        "required_for_public_clients": true
      },
      
      "state_parameter": {
        "enabled": true,
        "entropy_bits": 128,
        "validation_required": true
      },
      
      "nonce": {
        "enabled": true,
        "entropy_bits": 128,
        "validation_required": true
      },
      
      "tls": {
        "minimum_version": "1.3",
        "certificate_validation": true,
        "hostname_verification": true,
        "cipher_suites": ["TLS_AES_256_GCM_SHA384", "TLS_CHACHA20_POLY1305_SHA256"]
      }
    },
    
    "cac_piv_integration": {
      "enabled": true,
      "certificate_binding": true,
      "pin_verification": true,
      "card_authentication": true,
      
      "certificate_validation": {
        "ocsp_validation": true,
        "crl_validation": true,
        "path_validation": true,
        "trust_anchor_validation": true
      },
      
      "subject_mapping": {
        "dn_attribute": "subject",
        "email_attribute": "subjectAltName",
        "edipi_attribute": "subjectAltName"
      }
    },
    
    "rbac_integration": {
      "role_claim": "qlik_roles",
      "permission_claim": "qlik_permissions",
      "clearance_claim": "security_clearance",
      "compartment_claim": "compartments",
      
      "attribute_mapping": {
        "user_id": "sub",
        "email": "email",
        "name": "name",
        "organization": "org",
        "department": "dept",
        "clearance_level": "clearance",
        "edipi": "edipi"
      },
      
      "role_hierarchy": {
        "qlik:admin": {
          "inherits": ["qlik:developer", "qlik:user"],
          "rbac_roles": ["data_steward", "security_admin"]
        },
        "qlik:developer": {
          "inherits": ["qlik:user"],
          "rbac_roles": ["analyst", "data_steward"]
        },
        "qlik:user": {
          "rbac_roles": ["analyst", "operator"]
        }
      }
    },
    
    "permission_mapping": {
      "qlik_permissions": {
        "app.read": {
          "rbac_permissions": ["qlik:app:read"],
          "classification_required": "UNCLASSIFIED"
        },
        "app.create": {
          "rbac_permissions": ["qlik:app:create", "qlik:app:read"],
          "classification_required": "UNCLASSIFIED",
          "approval_required": true
        },
        "app.update": {
          "rbac_permissions": ["qlik:app:update", "qlik:app:read"],
          "classification_required": "UNCLASSIFIED",
          "approval_required": true
        },
        "app.delete": {
          "rbac_permissions": ["qlik:app:delete"],
          "classification_required": "CONFIDENTIAL",
          "approval_required": true,
          "dual_authorization": true
        },
        "space.read": {
          "rbac_permissions": ["qlik:space:read"],
          "classification_required": "UNCLASSIFIED"
        },
        "space.create": {
          "rbac_permissions": ["qlik:space:create"],
          "classification_required": "CONFIDENTIAL",
          "approval_required": true
        },
        "data.read": {
          "rbac_permissions": ["qlik:data:read"],
          "classification_required": "UNCLASSIFIED",
          "need_to_know": true
        },
        "data.export": {
          "rbac_permissions": ["qlik:data:export"],
          "classification_required": "CONFIDENTIAL",
          "approval_required": true,
          "audit_required": true
        }
      }
    },
    
    "session_management": {
      "session_timeout": 3600,
      "idle_timeout": 900,
      "max_concurrent_sessions": 3,
      "session_tracking": true,
      "device_binding": true,
      
      "logout": {
        "front_channel_logout": true,
        "back_channel_logout": true,
        "session_cleanup": true,
        "token_revocation": true
      }
    },
    
    "audit_configuration": {
      "enabled": true,
      "log_authentication": true,
      "log_authorization": true,
      "log_token_operations": true,
      "log_permission_checks": true,
      
      "audit_events": [
        "oauth_authentication_start",
        "oauth_authentication_success",
        "oauth_authentication_failure",
        "token_issued",
        "token_refreshed",
        "token_revoked",
        "permission_granted",
        "permission_denied",
        "session_created",
        "session_expired",
        "logout_initiated"
      ],
      
      "retention_policy": {
        "authentication_logs": "3 years",
        "authorization_logs": "7 years",
        "token_logs": "1 year",
        "session_logs": "1 year"
      }
    },
    
    "error_handling": {
      "retry_configuration": {
        "max_retries": 3,
        "backoff_strategy": "exponential",
        "initial_delay": 1000,
        "max_delay": 30000
      },
      
      "error_responses": {
        "authentication_failure": {
          "error_code": "authentication_failed",
          "message": "Authentication failed",
          "log_level": "WARNING"
        },
        "authorization_failure": {
          "error_code": "access_denied",
          "message": "Access denied",
          "log_level": "WARNING"
        },
        "token_expired": {
          "error_code": "token_expired",
          "message": "Token has expired",
          "log_level": "INFO"
        },
        "invalid_scope": {
          "error_code": "invalid_scope",
          "message": "Invalid or insufficient scope",
          "log_level": "WARNING"
        }
      }
    },
    
    "monitoring": {
      "health_checks": {
        "enabled": true,
        "endpoint": "/health/qlik-oauth",
        "interval": 60,
        "timeout": 10
      },
      
      "metrics": {
        "enabled": true,
        "authentication_success_rate": true,
        "token_issuance_rate": true,
        "permission_check_latency": true,
        "error_rate": true
      },
      
      "alerts": {
        "authentication_failure_threshold": 10,
        "token_error_threshold": 5,
        "permission_denial_threshold": 20,
        "response_time_threshold": 5000
      }
    },
    
    "development_settings": {
      "debug_mode": false,
      "verbose_logging": false,
      "token_introspection_logging": false,
      "skip_certificate_validation": false,
      "mock_cac_validation": false
    }
  }
}